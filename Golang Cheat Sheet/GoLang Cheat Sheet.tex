% Mo Jabeen Template for docs 

\documentclass[11pt]{scrartcl} % Font size

\input{structure.tex} % Include the file specifying the document structure and custom commands

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------


\title{	
	\normalfont\normalsize
	\vspace{20pt} % Whitespace
	{\huge Golang Cheat Sheet}\\ % The meh
	\vspace{12pt} % Whitespace
	\rule{\linewidth}{2pt}\\ % Thick bottom horizontal rule
}

\author{\small Dainish Jabeen} % Your name

\date{\normalsize\today} % Today's date (\today) or a custom date

\begin{document}

\maketitle % Print the title

\section{Packages}

Go uses packages, which can contain multiple files. \textbf{The app will start running in the main 
application.}\\

Names exported outside the packages, must use a Capital letter.

\begin{lstlisting}[
	caption= Golang basics, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	package main

	import "fmt"

	func main(){
		fmt.Println("Hello World")
	}

\end{lstlisting}

\newpage

\section{Basics}

\subsection{Types}

\begin{lstlisting}[
	caption= Golang types, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	:= //Declare and initialize non explicit type
	>> //Shift bitwise right
	<<  //Shift bitwise left

	//ARRAY
	name []string 
	var := []string("blah","meh")

	//MAPS
	map[key type]val type //Dict has to be made
	m := make(map[string]String)

	elem, ok = m[key] // check key exists

	// Initialization

	var i int // initializes as 0

	// Constants

	const(
		x=1 // the type of this can change on context
	)

	p := &i //point to i
	*p //value of i, changes will change also change i

	type Name struct{
		x int
		y int
	}

	// Pointers to structs

	v := StructName{1,2}

	p = &v
	p.x = //Will change the value of v

	// Struct constructors

	v := StructName{x:1} //Others members made 0

	//SLICES

	//Slices acts as pointers

	a[1:] // slice to end
	s := a[:3] // slice start to 3

	cap(s) // Capacity, elements in underlying array

	// Dynamically size arrays

	a := make(type,len,cap)
	append(arr,val)
	
\end{lstlisting}

\newpage

\subsection{Functions}

\begin{lstlisting}[
	caption= Functions, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	func Name(name type) type{}

	//FUNC PARAMS

	func name(x int,y int)
	func name(x,y int)

	//NAKED RETURN

	func() (x,y int) {
		x:=1
		y:=2
		return
	} // Will return x and y 

\end{lstlisting}

\subsubsection{Funcs as params}

\begin{lstlisting}[
	caption= Params, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	func compute(fn func(float64, float64) float64) float64 {
	return fn(3, 4)
	}

	func main() {
		hypot := func(x, y float64) float64 {
			return math.Sqrt(x*x + y*y)
		}
		fmt.Println(hypot(5, 12))

		fmt.Println(compute(hypot))
		fmt.Println(compute(math.Pow))
	}

\end{lstlisting}

\subsubsection{Funcs as closures}

Reference var from outside the body and be bound to that value, which when called
includes any prev changes to those vars.

Allows a state of memory via an assigned variable to a func of the internal variables of that func.

\begin{lstlisting}[
	caption= Params, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	func adder() func(int) int {
		sum := 0
		return func(x int) int {
			sum += x
			return sum
		}
	}
	
	func main() {
		pos, neg := adder(), adder()
		for i := 0; i < 10; i++ {
			fmt.Println(
				pos(i),
				neg(-2*i),
			)
		}
	}

\end{lstlisting}

\subsection{Control}

\begin{lstlisting}[
	caption= Control, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	for i:=0;i<10;i++{}

	for x<100 {} //Same as while loop

	if statement; cond {}

	switch statement; val {

		case x: //x same as val == x

		case y: //y same as val == y

		default:
	}

	defer expr //execute expr at the end of func, can stack defers

	for i,v := range arr {} // Loops through array (can do _,v or i,_)

\end{lstlisting}

\section{Methods}

Function with a receiver argument, ie accessed through an object (normally a struct). 
Generally a type through which the function allows for polymorphism.

\begin{lstlisting}[
	caption= Methods, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	type blah struct{
		x int
	}

	func (v blah) Name() int {} // v can access all members of the struct.

	func (v *blah) Name() int {} //Pointer allows changing of structs.

	// v.Name() interpreted as &v.Name()
\end{lstlisting}

\begin{itemize}
	\item Pointers good for performance as copying is avoided
	\item \textbf{Should avoid mixing methods of val and pointers}
\end{itemize}

\subsection{Interfaces}

Interfaces are a type of data via you can access a set defined number of methods.

This can:
\begin{itemize}
	\item Define behavior of an object (a type that uses a chosen interface must also have 
	accompanying methods)
	\item Decouple code, allow use of methods without needing to know the details of the objects
	\item polymorphism same func does different things based on interface
\end{itemize}

\begin{lstlisting}[
	caption= Interfaces, % Caption above the listing
	language=python, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	type Name interface{
		method()
	}

	interface{} // Empty interface can hold any type

	// Type Assertion

	var := interface{} = "h"

	s := var.(string) // Gives the value in the interface
	s := var.(int) // Causes panic

	s,ok := i.(string) // Check

	switch v := i.(type){
		case int:

		case string:
	}

\end{lstlisting}

Fmt uses Stringer interface, that allows the method String() to be accessed via new types.

\section{Error}

Error method can be extended to use new types, which is auto called if the return type is error.

\begin{lstlisting}[
	caption= Error, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	// Kind of a struct with only a float stored
	type ErrNegativeSqrt float64 

	func (e ErrNegativeSqrt) Error() string {
		return fmt.Sprint("cannot Sqrt negative number:",
		float64(e))
	}

	func Sqrt(x float64) (float64, error) {
		if x > 0{
			return x*x,nil
		}else {
			return 0,ErrNegativeSqrt(x)
		}
	}

	func main() {
		fmt.Println(Sqrt(2))
		fmt.Println(Sqrt(-2))
	}

\end{lstlisting}

\section{Type Parameters}

Can use T as a generic type in parameters with a constraint.

\begin{lstlisting}[
	caption= Type Parameters, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	//s can be any type that is comparable
	func Name[T comparable](s T) int{} 

	type[T any] struct{
		next *List[T]
		val
	} 
	
	v := List[int]{nil,3} // Before use need to define T

\end{lstlisting}

\section{Concurrency}

\subsection{Go routines}

Lightweight thread managed by the Go routine.

\[ go\;f(x,y,z) \]

Eval of f happens in current routine, execution happens in new routine. Happens in the 
same address space.

\subsection{Channels}

Type conduit to send/receive values through the routines.

\[ ch\;<-v,\;v:=<-ch \]

The data flows in arrows direction. Like maps and slices need to make before use, send
and receive will block until channel is ready. Add length to make buffered lengths.\\

Sends can close the channel so no more vals will be sent. Use ,ok to check if channel is closed,
sending on a closed channel causes a panic.

\begin{lstlisting}[
	caption= Channels, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	func fibonacci(n int, c chan int) {
	x, y := 0, 1
	for i := 0; i < n; i++ {
		c <- x
		x, y = y, x+y
	}
	close(c)
	}

	func main() {
		c := make(chan int, 10)
		go fibonacci(cap(c), c)
		for i := range c { // Receives until c is closed
			fmt.Println(i)
		}
	}

\end{lstlisting}

Select with a channel will block until one of its cases can run (a channel is not empty), 
unless theres a default.

\subsection{Mutual exclusion}

\begin{lstlisting}[
	caption= Mutal exclusion, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	var mu sync.Mutex

	mu.Lock
	mu.Unlock 

\end{lstlisting}

Lock will wait for another lock to unlock before continuing, can use defer to unlock. Locks are queued
in order.

\section{Testing}

A test file name, should end with \_test.go.

\begin{lstlisting}[
	caption= Test example, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	package example

	import "testing"

	func TestExample(t *testing.T){
		if testResult != example {
			test.Errorf{"This test has failed "}
		}
	}

\end{lstlisting}

Use go test to run the file.

\section{Modules}

Dependencies are managed via modules, the go.mod file tracks them.\\

After adding an import to the package the mod file should be tidied.

\begin{lstlisting}[
	caption= Module Commands, % Caption above the listing
	language=Go, % Use Julia functions/syntax highlighting
	frame=single, % Frame around the code listing
	showstringspaces=false, % Don't put marks in string spaces
	numbers=left, % Line numbers on left
	numberstyle=\large, % Line numbers styling
	]

	go mod init [path] // Initalise setup
	go mod tidy // Add imports to mod file

	go mode -replace [mod name] = [path]
	// replace path of mod to local file

\end{lstlisting}

Module path is normally: <prefix>/<descriptive-text> \\

Prefix: The location ie github.com \\
Descriptive text: Project name

\subsection{Workspaces}

Use work spaces to control multiple and locally change modules. Allows reference to packages inside a module
outside the module in the workspace.

\[ go\;work\;init\; ./module_name \]
\[ go\;work\;use\; ./module_name \]

Ensure the local module has the same name .mod file as the package name and then replace the 
workspace path to local.

\[ go\;mod\;edit\;-replace\;[module name]\;=\;[full path]\]

\section{APIs}

Gin is a HTTP web framework written in golang. TBA

\section{Fuzzing}

A method of testing with random injections of data. TBA

%----------------------------------------------------------------------------------------
%	FIGURE EXAMPLE
%----------------------------------------------------------------------------------------

% \begin{figure}[h] % [h] forces the figure to be output where it is defined in the code (it suppresses floating)
% 	\centering
% 	\includegraphics[width=0.5\columnwidth]{IMAGE_NAME.jpg} % Example image
% 	\caption{European swallow.}
% \end{figure}

%----------------------------------------------------------------------------------------
% MATH EXAMPLES
%----------------------------------------------------------------------------------------

% \begin{align} 
% 	\label{eq:bayes}
% 	\begin{split}
% 		P(A|B) = \frac{P(B|A)P(A)}{P(B)}
% 	\end{split}					
% \end{align}

%----------------------------------------------------------------------------------------
%	LIST EXAMPLES
%----------------------------------------------------------------------------------------

% \begin{itemize}
% 	\item First item in a list 
% 		\begin{itemize}
% 		\item First item in a list 
% 			\begin{itemize}
% 			\item First item in a list 
% 			\item Second item in a list 
% 			\end{itemize}
% 		\item Second item in a list 
% 		\end{itemize}
% 	\item Second item in a list 
% \end{itemize}

%------------------------------------------------

% \subsection{Numbered List}

% \begin{enumerate}
% 	\item First item in a list 
% 	\item Second item in a list 
% 	\item Third item in a list
% \end{enumerate}

%----------------------------------------------------------------------------------------
%	TABLE EXAMPLE
%----------------------------------------------------------------------------------------

% \section{Interpreting a Table}

% \begin{table}[h] % [h] forces the table to be output where it is defined in the code (it suppresses floating)
% 	\centering % Centre the table
% 	\begin{tabular}{l l l}
% 		\toprule
% 		\textit{Per 50g} & \textbf{Pork} & \textbf{Soy} \\
% 		\midrule
% 		Energy & 760kJ & 538kJ\\
% 		Protein & 7.0g & 9.3g\\
% 		\bottomrule
% 	\end{tabular}
% 	\caption{Sausage nutrition.}
% \end{table}

%----------------------------------------------------------------------------------------
%	CODE LISTING EXAMPLE
%----------------------------------------------------------------------------------------

% \begin{lstlisting}[
% 	caption= Macro definition, % Caption above the listing
% 	language=python, % Use Julia functions/syntax highlighting
% 	frame=single, % Frame around the code listing
% 	showstringspaces=false, % Don't put marks in string spaces
% 	numbers=left, % Line numbers on left
% 	numberstyle=\large, % Line numbers styling
% 	]

% 	CODE

% \end{lstlisting}

%----------------------------------------------------------------------------------------
%	CODE LISTING FILE EXAMPLE
%----------------------------------------------------------------------------------------

% \lstinputlisting[
% 	caption=Luftballons Perl Script., % Caption above the listing
% 	label=lst:luftballons, % Label for referencing this listing
% 	language=Perl, % Use Perl functions/syntax highlighting
% 	frame=single, % Frame around the code listing
% 	showstringspaces=false, % Don't put marks in string spaces
% 	numbers=left, % Line numbers on left
% 	numberstyle=\tiny, % Line numbers styling
% 	]{luftballons.pl}

%----------------------------------------------------------------------------------------
%	BIB EXAMPLE
%----------------------------------------------------------------------------------------

% Using \texttt{biblatex} you can display a bibliography divided into sections, depending on citation type. 
% Let's cite! Einstein's journal paper \cite{einstein} and Dirac's book \cite{dirac} are physics-related items. 
% Next, \textit{The \LaTeX\ Companion} book \cite{latexcompanion}, Donald Knuth's website \cite{knuthwebsite}, \textit{The Comprehensive Tex Archive Network} (CTAN) \cite{ctan} are \LaTeX-related items; but the others, Donald Knuth's items, \cite{knuth-fa,knuth-acp} are dedicated to programming. 

% \medskip

% \printbibliography[
% heading=bibintoc,
% title={Whole bibliography}
% ] %Prints the entire bibliography with the title "Whole bibliography"

% %Filters bibliography
% \printbibliography[heading=subbibintoc,type=article,title={Articles only}]
% \printbibliography[type=book,title={Books only}]

% \printbibliography[keyword={physics},title={Physics-related only}]
% \printbibliography[keyword={latex},title={\LaTeX-related only}]

\end{document}